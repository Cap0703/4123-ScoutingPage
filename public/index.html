<!doctype html>
<html><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"/>
<title>FRC 4123 Scouting</title>
<link rel="stylesheet" href="/css/style.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<!-- Mobile navigation -->
<div class="mobile-nav">
  <button class="hamburger" onclick="toggleMenu()">☰</button>
  <div class="mobile-menu" id="mobileMenu">
    <button class="mobile-menu-close" onclick="toggleMenu()">×</button>
    <a href="/" onclick="toggleMenu()">Home</a>
    <a href="/pages/match_scouting.html" onclick="toggleMenu()">Match Scouting</a>
    <a href="/pages/pit_scouting.html" onclick="toggleMenu()">Pit Scouting</a>
    <a href="/pages/team_summary.html" onclick="toggleMenu()">Team Summary</a>
    <a href="/pages/match_simulator.html" onclick="toggleMenu()">Match Simulator</a>
    <a href="/pages/rankings.html" onclick="toggleMenu()">Rankings</a>
    <a href="/pages/raw_match.html" onclick="toggleMenu()">Raw Match Data</a>
    <a href="/pages/raw_match_edit.html" onclick="toggleMenu()">Raw Match Data Edit</a>
    <a href="/pages/raw_pit.html" onclick="toggleMenu()">Raw Pit Data</a>
    <a href="/pages/raw_pit_edit.html" onclick="toggleMenu()">Raw Pit Data Edit</a>
  </div>
</div>
<script>
// Mobile menu functionality
function toggleMenu() {
  const menu = document.getElementById('mobileMenu');
  const isOpening = !menu.classList.contains('open');
  menu.classList.toggle('open');
  document.body.classList.toggle('menu-open', isOpening);
  if (isOpening) {
    setTimeout(() => {
      menu.scrollTop = 0;
    }, 50);
  }
}

// Close menu when clicking outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById('mobileMenu');
  const hamburger = document.querySelector('.hamburger');
  if (menu.classList.contains('open') && 
      !menu.contains(event.target) && 
      event.target !== hamburger) {
    toggleMenu();
  }
});

// Close menu on escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const menu = document.getElementById('mobileMenu');
    if (menu.classList.contains('open')) {
      toggleMenu();
    }
  }
});

// Prevent background scrolling when menu is open
document.addEventListener('touchmove', function(event) {
  const menu = document.getElementById('mobileMenu');
  if (menu.classList.contains('open')) {
    if (!menu.contains(event.target)) {
      event.preventDefault();
    }
  }
}, { passive: false });
</script>
<!-- Original navbar (hidden on mobile) -->
<nav class="navbar">
  <a href="/">Home</a>
  <a href="/pages/match_scouting.html">Match Scouting</a>
  <a href="/pages/pit_scouting.html">Pit Scouting</a>
  <a href="/pages/team_summary.html">Team Summary</a>
  <a href="/pages/match_simulator.html">Match Simulator</a>
  <a href="/pages/rankings.html">Rankings</a>
  <a href="/pages/raw_match.html">Raw Match Data</a>
  <a href="/pages/raw_match_edit.html">Raw Match Data Edit</a>
  <a href="/pages/raw_pit.html">Raw Pit Data</a>
  <a href="/pages/raw_pit_edit.html">Raw Pit Data Edit</a>
</nav>
<div class="container">
    <div class="center">
      <h1>FRC 4123 Scouting Webpage</h1>
      <p class="badge">Created by Conrad Oldoerp</p>
      
      <!-- Announcements Section -->
      <div id="announcements-container" class="announcements-container"></div>
      
      <!-- Checklist Section -->
      <div id="checklist-container" class="checklist-container"></div>
      
      <div class="card">
        <p>Dynamic, JSON-configurable forms. Totals auto-calculated and stored. Inline editing, CSV export, rankings, simulator, and Chart.js coral accuracy.</p>
      </div>
    </div>
</div>
<footer>FRC 4123 Scouting • Config-driven • SQLite</footer>

<script>
// Global variables
let checklistItems = [];
let checklistState = {};

// Load home page content from config
async function loadHomeContent() {
  try {
    const response = await fetch('/api/config');
    const config = await response.json();
    
    // Load announcements and checklist from the body section
    if (config.Home && config.Home.body) {
      const bodyItems = Object.values(config.Home.body);
      
      // Separate announcements and checklist
      const announcements = bodyItems.filter(item => item.type === 'announcement');
      const checklist = bodyItems.find(item => item.type === 'checklist');
      
      if (announcements.length > 0) {
        renderAnnouncements(announcements);
      }
      
      if (checklist) {
        checklistItems = checklist.options || [];
        // Load checklist state from server
        await loadChecklistState();
        renderChecklist(checklist);
      }
    }
  } catch (error) {
    console.error('Error loading home content:', error);
  }
}

// Load checklist state from server
async function loadChecklistState() {
  try {
    const response = await fetch('/api/checklist');
    if (response.ok) {
      checklistState = await response.json();
    } else {
      // Initialize empty state if not found
      checklistState = {};
    }
  } catch (error) {
    console.error('Error loading checklist state:', error);
    checklistState = {};
  }
}

// Save checklist state to server
async function saveChecklistState() {
  try {
    await fetch('/api/checklist', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(checklistState)
    });
  } catch (error) {
    console.error('Error saving checklist state:', error);
  }
}

// Render announcements
function renderAnnouncements(announcements) {
  const container = document.getElementById('announcements-container');
  if (!container || !announcements || announcements.length === 0) return;
  
  let html = '<h2>Announcements</h2>';
  announcements.forEach(announcement => {
    html += `
      <div class="announcement">
        <div class="announcement-title">${announcement.title || 'Untitled'}</div>
        <div class="announcement-description">${announcement.description || ''}</div>
        <hr class="announcement-divider">
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// Render checklist
function renderChecklist(checklist) {
  const container = document.getElementById('checklist-container');
  if (!container || !checklistItems || checklistItems.length === 0) return;
  
  let html = `<h2>${checklist.title || 'Checklist'}</h2><div class="checklist">`;
  checklistItems.forEach((item, index) => {
    const isChecked = checklistState[index] || false;
    
    html += `
      <div class="checklist-item">
        <label>
          <input type="checkbox" data-index="${index}" ${isChecked ? 'checked' : ''} 
                 onchange="updateChecklistItem(this)">
          <span>${item}</span>
        </label>
      </div>
    `;
  });
  html += '</div>';
  
  container.innerHTML = html;
}

// Update checklist item state
async function updateChecklistItem(checkbox) {
  const index = checkbox.getAttribute('data-index');
  checklistState[index] = checkbox.checked;
  
  // Save to server
  await saveChecklistState();
}

// Load home content when page loads
document.addEventListener('DOMContentLoaded', loadHomeContent);

// Poll for checklist updates every 5 seconds
setInterval(async () => {
  const oldState = JSON.stringify(checklistState);
  await loadChecklistState();
  const newState = JSON.stringify(checklistState);
  
  // If state changed, re-render checklist
  if (oldState !== newState) {
    const checklist = { options: checklistItems };
    renderChecklist(checklist);
  }
}, 5000);
</script>

</body></html>